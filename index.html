<!doctype html>
<html>
<head>
    <script src="jquery.min.js"></script>
    <title>Ads</title>
    <style>
    body, div, span, a {
        font-family: Arial, Helvetica, sans-serif;
    }
    .circle {
        border-radius: 50%;
        background-color: black;
        color: white;
        padding-left:4px;
        padding-right:4px;
        font-weight: 100;
    }
    </style>
</head>
<body style="background-color:#fff">
<!--
http://wpcontent.answcdn.com/wikipedia/commons/thumb/4/43/Standard_web_banner_ad_sizes.svg/580px-Standard_web_banner_ad_sizes.svg.png
-->
<div style="padding:0.5em; background-color:inherit; width:700px">
<div>
    <img src="5days-jane-herman-bishop-shop-the-look-2_140524899120.jpg_article_gallery_slideshow_v2.jpg">
</div>
<div style="font-family:sans-serif">
<span class="circle">1</span> Christopher Kane striped-detail cotton sweatshirt,
<span id="a0"><span class="price">$444</span>; <span class="site"><a href="http://www.brownsfashion.com/">brownsfashion.com</a></span></span>
<span class="circle">2</span> Rag &amp; Bone Boyfriend jean,
<span id="a1"><span class="price">$220</span>; <span class="site"><a href="http://www.lagarconne.com/">lagarconne.com</a></span></span>
<span class="circle">3</span> MAC Cosmetics Eye Kohl in Powersurgem
<span id="a2"><span class="price">$16</span>; <span class="site"><a href="http://www.maccosmetics.com/">maccosmetics.com</a></span></span>
<span class="circle">4</span> Clare Vivier Foldover clutch,
<span id="a3"><span class="price">$185</span>; <span class="site"><a href="http://www.stevenalan.com/">stevenalan.com</a></span></span>
<span class="circle">5</span> Vans Authentic Lo Pro Sneaker;
<span id="a4"><span class="price">$45</span>; <span class="site"><a href="http://www.nordstrom.com/">nordstrom.com</a></span></span>
<span class="circle">6</span> Balenciaga golden thick tube ring set,
<span id="a5"><span class="price">$765</span>; <span class="site"><a href="http://www.barneys.com/">barneys.com</a></span></span>
</div>
</div>

<script>

var colors = [
    //'red',
    'orange'
    ,'yellow'
    ,'green'
    ,'blue'
    ,'indigo'
    ,'violet'
];

function bid(span)
{
    var price = $('span#'+span+' span.price').text().substr(1);
    var jqxhr = $.ajax({
        url: 'http://localhost:3031/ad?price='+price+'&t='+Date.now(),
        dataType: 'json',
        timeout: 3000
    })
    .done(function(data) {
        if (data['id']) {
            var bgcolor = colors[data['id'] % colors.length];
            var price = data['price'];
            var vendor = data['id'];
            var link = 'http://www.' + data['id'] + '/';
            console.log(span, price, data, link);

            $('span#'+span+' span.price').text('$'+Math.round(price));
            $('span#'+span+' span.site a').attr('href', link);
            $('span#'+span+' span.site a').text(vendor);
            //$('span#'+span+' span.site').attr('background-color', bgcolor);
        }
    })
    .fail(function() {
        console.log("error");
        bgcolor = 'red';
    })
    .always(function() {
        //console.log("complete");
        //$('body').attr('bgcolor', bgcolor);
        $('span#'+span).show('slow');
    });
}

$(document).ready(function() {
    for (var i = 0; i < 6; i++) {
        var span = 'a'+i;
        $('span#'+span).hide()
        setTimeout(function(span) {
            return function() {
                bid(span)
            }
        }(span), 500*i);
    }
});
</script>

</body>
</html>
